<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simulated Rocket Flight</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #000; color: #fff; }
    #plot2D, #plot3D { width: 100%; height: 500px; background-color: #000; }
    h1, h2 { color: #fff; }
  </style>
</head>
<body>
  <h1>Simulated Rocket Flight</h1>
  
  <h2>Altitude Sensor (2D)</h2>
  <div id="plot2D"></div>
  
  <h2>GPS Trajectory (3D)</h2>
  <div id="plot3D"></div>

  <script>
    let sensorData = { x: [], y: [] }; // altitude over time
    let gpsData = { x: [], y: [], z: [] }; // lat, lon, alt
    let t = 0;

    // Rocket flight parameters
    const totalSteps = 200;
    const launchHeight = 0;
    const maxAltitude = 1000;

    // Initialize plots with black background
    Plotly.newPlot('plot2D', [{
      x: sensorData.x,
      y: sensorData.y,
      mode: 'lines+markers',
      line: { color: 'lime' },
      marker: { color: 'lime' },
      name: 'Altitude'
    }], {
      plot_bgcolor: '#000',
      paper_bgcolor: '#000',
      font: { color: '#fff' },
      xaxis: { title: 'Time' },
      yaxis: { title: 'Altitude (m)' }
    });

    Plotly.newPlot('plot3D', [{
      x: gpsData.x,
      y: gpsData.y,
      z: gpsData.z,
      mode: 'lines+markers',
      type: 'scatter3d',
      line: { color: 'cyan' },
      marker: { color: 'cyan', size: 3 },
      name: 'Trajectory'
    }], {
      plot_bgcolor: '#000',
      paper_bgcolor: '#000',
      font: { color: '#fff' },
      scene: {
        xaxis: { title: 'Latitude' },
        yaxis: { title: 'Longitude' },
        zaxis: { title: 'Altitude (m)' },
      }
    });

    function simulateFlight() {
      // 2D Sensor altitude (simple launch-apogee-descent profile)
      let altitude;
      if (t < totalSteps * 0.3) { // launch
        altitude = launchHeight + (maxAltitude * (t / (totalSteps * 0.3)));
      } else if (t < totalSteps * 0.6) { // apogee plateau
        altitude = maxAltitude;
      } else { // descent
        altitude = maxAltitude * (1 - (t - totalSteps * 0.6) / (totalSteps * 0.4));
      }
      // Add small noise
      altitude += (Math.random() - 0.5) * 10;

      sensorData.x.push(t);
      sensorData.y.push(altitude);
      Plotly.update('plot2D', { x: [sensorData.x], y: [sensorData.y] });

      // 3D GPS trajectory (simulate small lat/lon drift during flight)
      const latCenter = 12.9716;
      const lonCenter = 77.5946;
      const radius = 0.002;

      const angle = t * 0.1;
      const lat = latCenter + radius * Math.sin(angle);
      const lon = lonCenter + radius * Math.cos(angle);
      const alt = altitude; // use the same altitude as sensor

      gpsData.x.push(lat);
      gpsData.y.push(lon);
      gpsData.z.push(alt);
      Plotly.update('plot3D', { x: [gpsData.x], y: [gpsData.y], z: [gpsData.z] });

      t++;
      if (t <= totalSteps) {
        setTimeout(simulateFlight, 200); // update every 200ms
      }
    }

    simulateFlight();
  </script>
</body>
</html>
